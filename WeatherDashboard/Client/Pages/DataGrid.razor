@page "/datagrid"

@using ViewModels
@using WeatherDashboard.Shared.Models

@inherits DataGridBase


@if (Forecasts == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <h1>Three-day Weather Forecasts (&deg;C)</h1>
    <div class="container">
        <div class="row">
            <div class="col-sm">
                <SfAutoComplete TValue="string"
                                TItem="LocationResult"
                                Query="@GetQuery()"
                                @onkeypress="@(e => OnAutoCompleteKeyPressed(e))"
                                @onkeydown="@(e => OnAutoCompleteKeyDown(e))"
                                Placeholder="Location, e.g. Seattle"
                                @bind-Value="City">
                    <SfDataManager Url="@GetSearchUrl()"
                                   Adaptor="Adaptors.UrlAdaptor"
                                   CrossDomain="true">
                        <AutoCompleteFieldSettings Value="Name"></AutoCompleteFieldSettings>
                    </SfDataManager>
                </SfAutoComplete>
            </div>
            <div class="col-sm">
                <SfButton OnClick="OnAddClicked">Add</SfButton>
            </div>
        </div>
        <SfGrid DataSource="@Forecasts">
            <GridColumns>
                <GridColumn Field="@nameof(WeatherGridRow.City)"
                            AllowSorting="true"
                            IsPrimaryKey="true">
                </GridColumn>
                <GridColumn Field="@nameof(WeatherGridRow.Today)"
                            AllowSorting="false">
                    <Template>
                        @{
                            var forecast = context as WeatherGridRow;
                            <ForecastIcon DailyForecast="forecast.Today"></ForecastIcon>
                        }
                    </Template>
                </GridColumn>
                <GridColumn Field="@nameof(WeatherGridRow.Tomorrow)"
                            AllowSorting="false">
                    <Template>
                        @{
                            var forecast = context as WeatherGridRow;
                            <ForecastIcon DailyForecast="forecast.Tomorrow"></ForecastIcon>
                        }
                    </Template>
                </GridColumn>
                <GridColumn Field="@nameof(WeatherGridRow.ThirdDay)"
                            HeaderText="@DateTime.Today.AddDays(2).ToString("MM/dd")"
                            AllowSorting="false">
                    <Template>
                        @{
                            var forecast = context as WeatherGridRow;
                            <ForecastIcon DailyForecast="forecast.ThirdDay"></ForecastIcon>
                        }
                    </Template>
                </GridColumn>
            </GridColumns>
        </SfGrid>
    </div>
}
